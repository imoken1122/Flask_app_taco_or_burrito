## 3 実験手法

本節では, 実験で用いるクラスタリングの手法として,階層型クラスタリングとスペクトラルクラスタリングの概要とそれに関連する事項を説明する.

### 3.1 標準化レーベンシュタイン距離
　各ホスト間のペイロードの類似性を評価するため, レーベンシュタイン距離( LD )を用いる. レーベンシュタイン距離とは, ある文字列 $`s_i`$ と別の文字列 $`s_j`$ を挿入・削除・置換の操作によって一致させるための最小編集距離である. 例えば, 2 つの文字列「ABCD」「EFGH」は, 4 回の置換で文字列が一致するため, LD 4 である. しかしこのままで問題になることがある. 次の 2 つの文字「ABCD」「ABCDEFGH」は先ほどよりも視覚的には類似しているが, 4 回の削除で文字列が一致するため, LD は 4 で 前者と後者の類似度は等しくなってしまう. この問題は, 2つの文字列の内, 長い方の文字列長で LD を除算することで, 後者の類似度を高く評価することができ, これを 標準化レーベンシュタイン距離 (NLD) とする. 

```math
NLD(s_i,s_j) = \frac{LD(s_i,s_j)}{max(s_i, s_j)} \tag{1}
```
ただし, 値域は $` NLD \in (0,1) `$ となる. 実際にペイロードの類似度を計算する際は, ペイロードの 1byte を 1 文字とみなして NLD を計算する. 

### 3.2 類似度行列
2 つのクラスタリングの手法を実施するにあたり, あらかじめ類似度行列 $`A`$ を作成する必要がある. ここでの類似度行列とは, 式 (1) の NLD によって, 各送信元 IP アドレス間のペイロードの類似性を表現する対称行列となる. 

```math

  A =
    \begin{bmatrix}{}
      a_{11} & a_{12} & \ldots & a_{1n} \\
      a_{21} & a_{22} & \ldots & a_{2n} \\
      \vdots & \vdots & \ddots & \vdots \\
      a_{n1} & a_{m2} & \ldots & a_{nn}
    \end{bmatrix}

,a_{i,j} = 1- NLD(s_i,s_j) \tag2
```

ただし, $`n`$ は観測した IP アドレスの総数である. また, 類似度行列の値域は $`A \in (0,1)`$ であり, 1に近いほど類似していることにしたいため, ここでは NLD から 1 を引いている. よって, 2 つの文字列の類似度が近いほど 1 に近い値となる. 
また, この行列は重み付き隣接行列とも解釈でき, クラスタリングの文脈で考えると, エッジの重み $`a_{ij}`$ が大きいノード同士は同じクラスタに属し，エッジの重み $`a_{ij}`$ が小さいノード同士は異なるクラスタに属すようにクラスタリングする.

### 3.3 スペクトラルクラスタリング

　スペクトラルクラスタリングは, １つのグラフをいくつかの部分グラフに分割し, １つの部分グラフが１つのクラスタとみなしてクラスタリングを行う. 具体的には, 分割されるグラフ間は出来るだけ疎である状態が望ましく, それはエッジの重みの総和の最小化に等しい. この最小化は, 類似度行列と次数行列から得られるグラフラプラシアンの固有値問題の解に対応しており, 得られた固有ベクトルは各部分グラフの指示ベクトルとなる. よって, 固有値の小さい順に対応する任意の数の固有値ベクトルに対して, k-means などでクラスタリングする. この一連の流れを Algorithm1 に示す. 

```math
類似度行列 A, クラスタ数 k \\
1. D = \sum_{i,j} A_{ij} より次数行列を作成. \\
2. A,D を用いて, グラフラプラシアン L = I - D^{-1/2}AD^{-1/2} を作成.\\
3. L の固有値\lambda_i,固有値ベクトル e_i を求め, 固有値が小さい順に固有値ベクトルを k 個抽出し, 行列 U を作成.\\
4. U に対して, k-means などでクラスタリングを行う. 

```






### 控え

　各ホスト間のペイロードの類似性を評価するため, レーベンシュタイン距離( LD )を用いる. レーベンシュタイン距離とは, ある文字列 $`s_i`$ と別の文字列 $`s_j`$ を挿入・削除・置換の操作によって一致させるための最小編集距離である. 例えば, 2 つの文字列「ABCD」「EFGH」は, 4 回の置換で文字列が一致するため, LD 4 である. しかしこのままで問題になることがある. 次の 2 つの文字「ABCD」「ABCDEFGH」は先ほどよりも視覚的には類似しているが, 4 回の削除で文字列が一致するため, LD は 4 で 前者と後者の類似度は等しくなってしまう. この問題は, 2つの文字列の内, 長い方の文字列長で LD を除算することで, 後者の類似度を高く評価することができ, これを 標準化レーベンシュタイン距離 (NLD) とする. 
